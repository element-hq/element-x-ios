name: UITests

schemes:
  UITests:
    analyze:
      config: Debug
    archive:
      config: Release
    build:
      targets:
        UITests: all
    profile:
      config: Release
    run:
      config: Debug
      disableMainThreadChecker: false
    test:
      config: Debug
      testPlans:
        - path: UITests.xctestplan
          defaultPlan: true

targets:
  UITests:
    type: bundle.ui-testing
    platform: iOS

    dependencies:
    - target: ElementX
    - package: MatrixRustSDK
      linkType: static
    - package: AnalyticsEvents
      linkType: static
    - package: AppAuth
      linkType: static
    - package: DeviceKit
      linkType: static
    - package: DTCoreText
      linkType: static
    - package: KeychainAccess
      linkType: static
    - package: Kingfisher
      linkType: static
    - package: PostHog
      linkType: static
    - package: SwiftyBeaver
      linkType: static
    - package: SwiftState
      linkType: static
    - package: GZIP
      linkType: static
    - package: Sentry
      linkType: static
    - package: SnapshotTesting
      linkType: static

    info:
      path: ../SupportingFiles/Info.plist

    settings:
      base:
        PRODUCT_NAME: UITests
        PRODUCT_BUNDLE_IDENTIFIER: ${BASE_BUNDLE_IDENTIFIER}.ui.tests
      debug:
      release:

    preBuildScripts:
      - name: Override Simulator Status Bars
        runOnlyWhenInstalling: false
        basedOnDependencyAnalysis: false
        shell: /bin/sh
        script: |
          python3 $PROJECT_DIR/Tools/Scripts/bootTestSimulator.py --name 'iPhone 13 Pro Max' --version 'iOS.16.1'
          python3 $PROJECT_DIR/Tools/Scripts/bootTestSimulator.py --name 'iPad (9th generation)' --version 'iOS.16.1'

    sources:
    - path: ../Sources
      excludes:
        - "**/__Snapshots__/**"
    - path: ../SupportingFiles
    - path: ../../Tools/Scripts/Templates/SimpleScreenExample/Tests/UI
    - path: ../../ElementX/Sources/Application/BuildSettings.swift
    - path: ../../ElementX/Sources/Screens/RoomScreen/View/Style/TimelineStyle.swift
    - path: ../../ElementX/Sources/Services/Analytics/AnalyticsConfiguration.swift
    - path: ../../ElementX/Sources/UITests/UITestScreenIdentifier.swift
    - path: ../../ElementX/Sources/Generated/Strings.swift
    - path: ../../ElementX/Sources/Generated/Strings+Untranslated.swift
    - path: ../../ElementX/Resources
    - path: ../../ElementX/Sources/Other/Extensions/Bundle.swift
    - path: ../../ElementX/Sources/Other/Extensions/FileManager.swift
    - path: ../../ElementX/Sources/Other/InfoPlistReader.swift
    - path: ../../ElementX/Sources/Other/Extensions/URL.swift
